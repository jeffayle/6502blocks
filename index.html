<!doctype html>
<script type="module">
  var proc;
  var simulator;

  function $(x) {
    return document.getElementById(x);
  }

  function set_display(element_id, value_function) {
    $(element_id).value = value_function(proc).toString(16);
  }

  function single_step() {
    simulator.step(proc);
    set_display('instruction_register', simulator.readIR);
  }

  async function init() {
    const { instance } = await WebAssembly.instantiateStreaming(
      fetch("./6502.wasm")
    );
    simulator = instance.exports;
    proc = simulator.initAndResetChip();
    console.log(proc);
    $("step_button").addEventListener(
        "click", single_step);
  }
  init();
</script>

<style type="text/css">
  #view > input {
    position: absolute;
    font-size: 45px;
  }
  #instruction_register { left: 166px; top: 788px; width: 120px; }
</style>

<section id=view>
  <input type=button value=step id=step_button>
  <input type=text id=instruction_register>
  <img src="hanson.jpg">
</section>
